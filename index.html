// ✅ ANGEPASSTE FUNKTION: Zwei-Schritt-Prozess
async function selectClass(className) {
    selectedClass = className;
    
    // Hauptscreen anzeigen mit Ladeanimation
    document.getElementById('classScreen').classList.add('hidden');
    document.getElementById('mainScreen').style.display = 'block';
    document.getElementById('mainScreen').classList.remove('hidden');
    document.getElementById('classTitle').textContent = className + ' - Lädt...';
    document.getElementById('studentsList').innerHTML = '<div class="loading">Schülerdaten werden geladen...</div>';
    
    if (resumeUrl) {
        try {
            // ✅ SCHRITT 1: Klassendaten mit no-cors senden
            await fetch(resumeUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    day: selectedDay,
                    class: selectedClass,
                    timestamp: new Date().toISOString()
                })
            });
            
            console.log('Klassendaten gesendet');
            
            // ✅ SCHRITT 2: Kurz warten, dann Schülerdaten abrufen
            // n8n sendet in der Response eine neue URL zum Abrufen der Schülerdaten
            // Wir müssen auf eine neue resumeUrl warten oder einen zweiten Webhook-Endpunkt verwenden
            
            // OPTION A: Polling (alle 500ms prüfen, ob Daten bereit sind)
            setTimeout(async () => {
                // Hier müsstest du einen separaten GET-Endpunkt in n8n erstellen
                // oder die Schülerliste in einer zweiten resumeUrl bereitstellen
                
                // Für jetzt: Fallback auf Demo-Daten
                students = [
                    { id: 1, name: 'Demo Schüler 1', status: null },
                    { id: 2, name: 'Demo Schüler 2', status: null }
                ];
                
                document.getElementById('classTitle').textContent = className;
                studentsHistory = [];
                saveHistory();
                renderStudents();
            }, 1000);
            
        } catch (error) {
            console.error('Fehler:', error);
            document.getElementById('studentsList').innerHTML = '<div class="loading">Fehler beim Laden</div>';
        }
    }
}
